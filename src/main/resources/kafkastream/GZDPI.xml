<?xml version = "1.0" encoding = "utf-8"?>
<etl>
	<process id="gz_dpi" type="kafkaStreamProcess">
		<sourceMetaData type="kafkaStream" delimiter="\001">
			<kafka>
				<app_id>kafkaStream1020</app_id>
				<brokers>192.168.9.80:9091,192.168.9.80:9092,192.168.9.80:9093,192.168.9.80:9094,192.168.9.81:9095,192.168.9.81:9096,192.168.9.81:9097,192.168.9.81:9098</brokers>
				<client_id>gdnoce</client_id>
				<zookeeper>192.168.9.17:2181,192.168.9.16:2181,192.168.9.15:2181/kafka0.10</zookeeper>
				<inputTopic>gzdpi</inputTopic>
				<outputTopic>dpistream</outputTopic>
				<auto_offset_reset>latest</auto_offset_reset>
				<timestamp_extractor>org.apache.kafka.streams.processor.WallclockTimestampExtractor</timestamp_extractor>
			</kafka>
			<fields>
				<field id="ts" type="string" />
				<field id="ad" type="string" />
				<field id="srcip" type="string" />
				<field id="srcport" type="string" />
				<field id="dstip" type="string" />
				<field id="dstport" type="string" />
				<field id="host" type="string" />
				<field id="url" type="string" />
				<field id="ua" type="string" />
				<field id="cookie" type="string" />
				<field id="ref" type="string" />
				<field id="seq" type="string" />
				<field id="ack" type="string" />
				<field id="collectHost" />
			</fields>
		</sourceMetaData>
		<outputMetaData>
			<values delimiter="\001">
				<field id="ts" desc="starttime" />
				<field id="ad" desc="account" defaultValue="none"/>
				<field id="srcip" desc="sourceip" />
				<field id="srcport" desc="sourceport" />
				<field id="dstip" desc="destinationip" />
				<field id="dstport" desc="destinationport" />
				<field id="url" desc="destinationurl" defaultValue=""/>
				<field id="host" defaultValue=""/>
				<field id="path" defaultValue=""/>
				<field id="query" defaultValue=""/>
				<field id="domain" defaultValue=""/>
				<field id="ref" desc="referer" defaultValue=""/>
				<field id="ua" desc="useragent" defaultValue=""/>
				<field id="cookie" defaultValue=""/>
				<field id="weixinid" defaultValue=""/>
				<field id="qq" defaultValue=""/>
				<field id="buy_uin" defaultValue=""/>
				<field id="taobao_nick" defaultValue=""/>
				<field id="weibosup" defaultValue=""/>
				<field id="weiboname" defaultValue=""/>
				<field id="weibonick" defaultValue=""/>
				<field id="hour" />
				<field id="timeStamp" />
				<field id="day" />
				<field id="collectHost" />
			</values>
		</outputMetaData>
		<transforms>
			<transform>
				<filter name="DPIFilter" urlSuffixFile="conf/suffix-urlfilter.txt" />
				<!-- function name="RegexpExtract" input="ref" output="weixin" regexp="^http://weixin.qq.com/.*uin=(\\\d+).*" index="1"/ -->
				<function name="GetWXUIN" referer="ref" cookie="cookie" host="host" output="weixinid" />
				<function name="GetDomain" host="host" output="domain" />
				<function name="GetQQ" host="host" cookie="cookie" output="qq" />
				<function name="GetJD" host="host" cookie="cookie" output="buy_uin" />
				<function name="GetTaoBao" host="host" cookie="cookie" output="taobao_nick" />
				<function name="GetWeiBo" host="host" cookie="cookie">
					<output id="weibosup" />
					<output id="weiboname" />
					<output id="weibonick" />
				</function>
				<function name="GetDPITime" timestamp="ts" formatter="yyyyMMddHHmmss">
					<output id="hour"/>
					<output id="timeStamp"/>
					<output id="day"/>
				</function>
				<function name="GetPathAndQuery" host="host" url="url">
					<output id="path" />
					<output id="query" />
				</function>
			</transform>
		</transforms>
	</process>
</etl>
			