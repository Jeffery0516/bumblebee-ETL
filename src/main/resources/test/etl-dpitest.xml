<?xml version = "1.0" encoding = "utf-8"?>
<etl>
	<contextProperty location="etl-dpitest.properties" />

	<process id="gzdpi">
		<computingFrameworkConfigs>
			<property key="outputFormatClass"
				value="com.gsta.bigdata.etl.mapreduce.OnlyValueOutputFormat" />
			<property key="mapreduce.map.output.compress" value="true"/>
			<!-- property key="mapreduce.map.output.compress.codec" value="com.hadoop.compression.lzo.LzoCodec"/-->
			<property key="mapreduce.output.fileoutputformat.compress" value="true"/>
			<!-- property key="mapreduce.output.fileoutputformat.compress.codec" value="com.hadoop.compression.lzo.LzopCodec"/-->
		</computingFrameworkConfigs>
		<sourceMetaData type="simpleFlat" delimiter="\|">
			<paths>
				<inputPath path="${inputPath}" />
			</paths>
			<fields>
				<field id="ts" type="string" />
				<field id="ad" type="string" />
				<field id="srcip" type="string" />
				<field id="srcport" type="string" />
				<field id="dstip" type="string" />
				<field id="dstport" type="string" />
				<field id="host" type="string" />
				<field id="url" type="string" minLength="6" />
				<field id="ua" type="string" minLength="5" />
				<field id="cookie" type="string" />
				<field id="ref" type="string" minLength="6" />
				<field id="seq" type="string" />
				<field id="ack" type="string" />
			</fields>
		</sourceMetaData>
		<outputMetaData outputPath="${outputPath}">
			<values delimiter="|">
				<!-- urlInfo basic -->
				<field id="urldomain" defaultValue="\\N" />
				<field id="urlhost" defaultValue="\\N" />
				<field id="urlpath" defaultValue="\\N" />
				<field id="urlquery" defaultValue="\\N" />
				<!-- from source -->
				<field id="ts" desc="starttime" />
				<field id="ad" desc="account" />
				<field id="dstport" desc="protocol" />
				<field id="srcip" desc="sourceip" />
				<field id="srcport" desc="sourceport" />
				<field id="dstip" desc="destinationip" />
				<field id="dstport" desc="destinationport" />
				<field id="url" desc="destinationurl" />
				<field id="ua" desc="useragent" />
				<field id="cookie" />
				<field id="ref" desc="referer" />
				<!-- from shell command line -->
				<field id="city" defaultValue="gz" />
				<field id="stat_day" defaultValue="${stat_day}" />
			</values>
		</outputMetaData>
		<transforms>
			<transform scope="map">
				<function name="parseURL" input="url">
					<output id="urldomain" />
					<output id="urlhost" />
					<output id="urlpath" />
					<output id="urlquery" />
				</function>
			</transform>
		</transforms>
	</process>
</etl>